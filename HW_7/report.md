# Отчет о реализации обмена данными через разделяемую память с использованием функций POSIX

## Задание

Разработать программы клиента и сервера, взаимодействующих через разделяемую память с использованием функций POSIX. Клиент должен генерировать случайные числа в том же диапазоне, что и примеры, рассмотренные на семинаре. Сервер должен осуществлять вывод сгенерированных чисел. Требуется обеспечить корректное завершение работы для одного клиента и сервера, включая удаление сегмента разделяемой памяти и завершение работы обеих программ независимо от инициатора завершения.

## Описание работы программы
Программа-сервер и программа-клиент взаимодействуют через разделяемую память с использованием функций POSIX. В начале работы сервер создает сегмент разделяемой памяти с помощью функции shm_open и определяет его размер с помощью функции ftruncate. Затем сервер отображает сегмент разделяемой памяти на свое адресное пространство с помощью функции mmap.

Клиент также получает доступ к разделяемой памяти с помощью функции shm_open и отображает ее на свое адресное пространство с помощью функции mmap.

Программа-клиент генерирует случайные числа и записывает их в разделяемую память, устанавливая значение поля number структуры SharedData. Если значение number уже не равно -1, то клиент ожидает, пока сервер не прочитает число и сбросит его значение.

Программа-сервер периодически проверяет значение поля number в разделяемой памяти. Если обнаружено новое число (значение не равно -1), сервер выводит его на экран и сбрасывает значение числа в разделяемой памяти, устанавливая -1.

Корректное завершение работы программы достигается путем инициирования завершения работы клиентом. Клиент устанавливает значение поля finished в структуре SharedData равным 1. Сервер периодически проверяет значение поля finished. Если обнаружено значение 1, сервер завершает работу и переходит к удалению сегмента разделяемой памяти.

После завершения работы сервера, клиент проверяет, был ли сервер завершен. Если сервер завершился, клиент также завершает свою работу.

Оба процесса, клиент и сервер, отключаются от разделяемой памяти с помощью функции munmap. Затем сервер закрывает дескриптор разделяемой памяти с помощью функции close, а клиент закрывает свой дескриптор. После этого, сервер удаляет сегмент разделяемой памяти с помощью функции shm_unlink.


## Корректное завершение работы

Для обеспечения корректного завершения работы программы клиента и сервера, включая удаление сегмента разделяемой памяти, используется следующий подход:

1. Клиент инициирует завершение работы, устанавливая значение `finished` в структуре `SharedData` в 1.
2. Сервер периодически проверяет значение `finished`. Если обнаружено значение 1, сервер завершает работу и переходит к удалению сегмента разделяемой памяти.
3. После завершения работы сервера, клиент проверяет, был ли сервер завершен. Если сервер

завершился, клиент также завершает свою работу.
4. Оба процесса, клиент и сервер, отключаются от разделяемой памяти с помощью функции `munmap`. Затем, клиент и сервер закрывают дескрипторы разделяемой памяти с помощью функции `close`. Наконец, сервер удаляет сегмент разделяемой памяти с помощью функции `shm_unlink`.

Такой подход обеспечивает корректное завершение работы как для клиента, так и для сервера, а также удаление сегмента разделяемой памяти независимо от инициатора завершения.

## Завершение работы программы

   Для завершения работы программы, нажмите `Ctrl + C` в терминале, где запущена программа-клиент или программа-сервер. Оба процесса завершат работу, а сегмент разделяемой памяти будет автоматически удален.

## Заключение

Разработанные программы клиента и сервера, взаимодействующие через разделяемую память с использованием функций POSIX, обеспечивают обмен данными между процессами. При помощи корректного завершения работы и удаления сегмента разделяемой памяти, программы гарантируют надежное и безопасное взаимодействие.