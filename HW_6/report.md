# Отчет о реализации обмена данными через разделяемую память

## Задание

Разработать программы клиента и сервера, взаимодействующих через разделяемую память с использованием функций UNIX System V. Клиент должен генерировать случайные числа в том же диапазоне, что и примеры, рассмотренные на семинаре. Сервер должен осуществлять вывод сгенерированных чисел. Требуется обеспечить корректное завершение работы для одного клиента и сервера, включая удаление сегмента разделяемой памяти и завершение работы обеих программ независимо от инициатора завершения.

## Описание работы программы

Программа-сервер и программа-клиент взаимодействуют через разделяемую память, используя функции UNIX System V. В начале работы сервер создает сегмент разделяемой памяти с помощью функции `shmget` и прикрепляет его к своему адресному пространству с помощью функции `shmat`. Затем сервер ожидает данные от клиента.

Клиент, в свою очередь, получает доступ к сегменту разделяемой памяти, используя функцию `shmget`, и прикрепляет его к своему адресному пространству с помощью функции `shmat`. После прикрепления к сегменту, клиент начинает генерировать случайные числа и записывает их в разделяемую память.

Сервер периодически проверяет значение числа в разделяемой памяти. Если обнаружено новое число, сервер выводит его на экран и сбрасывает значение числа в разделяемой памяти. После вывода числа, сервер продолжает ожидать новых данных от клиента.

Клиент генерирует случайные числа и записывает их в разделяемую память. Если значение числа в разделяемой памяти равно -1, клиент записывает новое сгенерированное число в разделяемую память. После записи числа, клиент ожидает некоторое время и генерирует следующее число.

Оба процесса, клиент и сервер, могут корректно завершить работу. Клиент инициирует завершение, устанавливая значение `finished` в разделяемой памяти равным 1. Сервер периодически проверяет значение `finished`. Если обнаружено значение 1, сервер завершает работу и переходит к удалению сегмента разделяемой памяти. После завершения работы сервера, клиент проверяет, был ли сервер завершен, и также завершает свою работу.

По завершении работы клиента и сервера, оба процесса отключаются от сегмента разделяемой памяти с помощью функции `shmdt`. Затем, оба процесса удаляют сегмент разделяемой памяти с помощью функции `shmctl` и флага `IPC_RMID`.

Таким образом, программа обеспечивает надежное взаимодействие между клиентом и сервером через разделяемую память, а также корректное завершение работы и удаление сегмента разделяемой памяти.

## Корректное завершение работы

Для обеспечения корректного завершения работы программы клиента и сервера, включая удаление сегмента разделяемой памяти, используется следующий подход:

1. Клиент инициирует завершение работы, устанавливая значение `finished` в структуре `SharedData` в 1.
2. Сервер периодически проверяет значение `finished`. Если обнаружено значение 1, сервер завершает работу и переходит к удалению сегмента разделяемой памяти.
3. После завершения работы сервера, клиент проверяет, был ли сервер завершен. Если сервер завершился, клиент также завершает свою работу.
4. Оба процесса, клиент и сервер, отключают сегмент разделяемой памяти с помощью функции `shmdt` и удаляют сегмент с помощью функции `shmctl` и флага `IPC_RMID`.

Такой подход обеспечивает корректное завершение работы как для клиента, так и для сервера, а также удаление сегмента разделяемой памяти независимо от инициатора завершения.

## Запуск программы

Для запуска программы клиента и

 сервера, выполните следующие шаги:

1. Компиляция программ

   Компилируйте программы `server.c` и `client.c` с помощью компилятора C, например, GCC:

   ```bash
   gcc -o server server.c
   gcc -o client client.c
   ```

2. Запуск программы-сервера

   Запустите программу-сервер в одном терминале:

   ```bash
   ./server
   ```

   Программа-сервер создаст сегмент разделяемой памяти и будет ожидать данных от клиента.

3. Запуск программы-клиента

   Запустите программу-клиента в другом терминале:

   ```bash
   ./client
   ```

   Программа-клиент будет генерировать случайные числа и отправлять их серверу через разделяемую память.

4. Завершение работы программы

   Для завершения работы программы, нажмите `Ctrl + C` в терминале, где запущена программа-клиент или программа-сервер. Оба процесса завершат работу, а сегмент разделяемой памяти будет автоматически удален.